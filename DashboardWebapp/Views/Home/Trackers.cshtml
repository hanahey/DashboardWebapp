@model IEnumerable<DashboardWebapp.Models.TrackerViewModel>


<br />

<div style="border:solid">
    <h2 style="text-align:center">
        Trackers
        <a onclick="OpenAddModal()" style="cursor:pointer">
            <img src="@Url.Content("~/Images/add-button.png")" style="width:40px;height:40px;" />
        </a>
    </h2>

    @foreach (var item in Model)
    {

        <div class="body-content">
            <div class="header" style="background-color:#940303; color:white;">
                <div class="title">
                    <h4>
                        @Html.DisplayFor(modelItem => item.Name) &nbsp;
                        <a onclick="OpenEditModal(@item.Id)" style="cursor:pointer">
                            <img src="@Url.Content("~/Images/edit-button.png")" style="width:20px;height:20px" />
                        </a>
                        <a onclick="OpenDeleteModal(@item.Id)" style="cursor:pointer;color:#C00000">
                            <img src="@Url.Content("~/Images/delete-button.png")" style="width:20px;height:20px;" />
                        </a>
                    </h4>
                </div>
            </div>
            <div class="table">
                <div class="tr">
                    <div class="table-cell" style="padding-left:6px!important; padding-top:8px!important">
                        <img src="@Url.Content("~/Images/trophy-icon.png")" style="width:20px;height:20px" />
                        &ensp;
                        £ @Html.DisplayFor(modelItem => item.GoalAmount)
                    </div>
                    <div class="table-cell">
                        <img src="@Url.Content("~/Images/calendar-icon.png")" style="width:30px;height:30px" />
                        &ensp;
                        @Html.DisplayFor(modelItem => item.GoalDate)
                    </div>
                </div>

                @if (item.RecurringTransaction != null)
                {
                    <div class="tr">
                         @*<div class="form-group" @*style="text-align:center"*@
                        <div style="padding-bottom:4px!important">
                            <img src="@Url.Content("~/Images/recurring-transaction-icon.png")" style="width:30px;height:20px" />
                            &nbsp;
                            <text>£</text>
                            @if (@item.RecurringTransaction.Transactions.LastOrDefault().Amount > 0)
                            {
                                @item.RecurringTransaction.Transactions.LastOrDefault().Amount
                            }

                            else
                            {
                                @(-item.RecurringTransaction.Transactions.LastOrDefault().Amount)
                            }
                            <text> </text>
                            @item.RecurringTransaction.Period.Name
                        </div>                       
                            @*<a onclick="OpenStopModal(@item.Id)" style="cursor:pointer">
                                <input type="submit" value="Stop" class="btn btn-danger" />
                            </a>
                            <a onclick="OpenEditRecurringPaymentModal(@item.Id)" style="cursor:pointer">
                                <input type="submit" value="Edit Recurring Payment" class="btn btn-primary" />
                            </a>*@
                        @*</div>*@
                    </div>
                }

                <div class="tr">
                    <div style="padding-left:5px!important">
                        <img src="@Url.Content("~/Images/hourglass-icon.png")" style="width:20px;height:20px" />
                        &ensp;
                        £ @(item.AmountSaved) and
                        @((item.GoalDate - item.StartDate).TotalDays) Days Remaining
                    </div>
                </div>
            </div>

            <div class="form-group" style="text-align:center">
                <a onclick="OpenOneTimePaymentModal(@item.Id)" style="cursor:pointer">
                    <input type="submit" value="Add One-Time Payment" class="btn btn-success" />
                </a>
                @if (item.RecurringTransaction == null)
                {
                    <a onclick="OpenAddRecurringPaymentModal(@item.Id)" style="cursor:pointer">
                        <input type="submit" value="Add Recurring Payment" class="btn btn-success" />
                    </a>
                }
            </div>
            <br />
        </div>
    }

</div>

<!-- Edit Tracker Modal -->
<div class="modal fade" id="EditModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Edit Tracker</b></h4>
            </div>
            <div class="modal-body" id="EditPreview">
            </div>

        </div>

    </div>
</div>

<!-- Delete Tracker Modal -->
<div class="modal fade" id="DeleteModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Delete Tracker</b></h4>
            </div>
            <div class="modal-body" id="DeletePreview">
            </div>
        </div>
    </div>
</div>

<!-- Add Tracker Modal -->
<div class="modal fade" id="AddModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Add Tracker</b></h4>
            </div>
            <div class="modal-body" id="AddPreview">
            </div>
        </div>
    </div>
</div>

<!-- Add One Time Payment Modal -->
<div class="modal fade" id="OTPModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Add One-Time Payment</b></h4>
            </div>
            <div class="modal-body" id="OTPPreview">
            </div>
        </div>
    </div>
</div>

<!-- Add Recurring Payment Modal -->
<div class="modal fade" id="AddRPModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Add Recurring Payment</b></h4>
            </div>
            <div class="modal-body" id="AddRPPreview">
            </div>
        </div>
    </div>
</div>

<!--  Edit Recurring Payment Modal -->
<div class="modal fade" id="EditRPModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Edit Recurring Payment</b></h4>
            </div>
            <div class="modal-body" id="EditRPPreview">
            </div>
        </div>
    </div>
</div>

<!--  Stop Recurring Payment Modal -->
<div class="modal fade" id="StopRPModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Stop Recurring Payment</b></h4>
            </div>
            <div class="modal-body" id="StopRPPreview">
            </div>
        </div>
    </div>
</div>

<!-- Delete Tracker Modal -->
<div class="modal fade" id="DeleteModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#286090; color:white">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align:center"><b>Delete Tracker</b></h4>
            </div>
            <div class="modal-body" id="DeletePreview">
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
      function OpenEditModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("EditTracker", "Trackers")',
            data: { id: currentId },
            success: function (data) {
                $('#EditPreview').html(data);
                $('#EditModal').modal('show');
            }
        })
    }
    function OpenDeleteModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("DeleteTracker", "Trackers")',
            data: { id: currentId },
            success: function (data) {
                $('#DeletePreview').html(data);
                $('#DeleteModal').modal('show');
            }
        })
    }
    function OpenAddModal() {
        $.ajax({
            type: "Get",
            url: '@Url.Action("AddTracker", "Trackers")',
            data: null,
            success: function (data) {
                $('#AddPreview').html(data);
                $('#AddModal').modal('show');
            }
        })
    }
    function OpenOneTimePaymentModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("OneTimePayment", "Home")',
            data: { id: currentId },
            success: function (data) {
                $('#OTPPreview').html(data);
                $('#OTPModal').modal('show');
            }
        })
    }
    function OpenAddRecurringPaymentModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("AddRecurringPayment", "Home")',
            data: { id: currentId },
            success: function (data) {
                $('#AddRPPreview').html(data);
                $('#AddRPModal').modal('show');
            }
        })
    }
    function OpenEditRecurringPaymentModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("EditRecurringPayment", "Home")',
            data: { id: currentId },
            success: function (data) {
                $('#EditRPPreview').html(data);
                $('#EditRPModal').modal('show');
            }
        })
    }
    function OpenStopModal(currentId) {
        $.ajax({
            type: "Get",
            url: '@Url.Action("StopRecurringPayment", "Home")',
            data: { id: currentId },
            success: function (data) {
                $('#StopRPPreview').html(data);
                $('#StopRPModal').modal('show');
            }
        })
    }


</script>

<style>
    #AddModal {
        height: 400px;
        top: calc(50% - 200px) !important;
    }

    #OTPModal {
        height: 450px;
        top: calc(45% - 200px) !important;
    }

    .title {
        padding: 5px;
        text-align: center;
    }

    .table {
        display: table;
        width: 100%;
        font-weight: bold;
        font-size: medium;
    }

    .tr {
        display: table-row;
    }

    .table-cell {
        display: table-cell;
    }
</style>

